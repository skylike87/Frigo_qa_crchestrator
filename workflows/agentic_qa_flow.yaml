id: agentic_qa_flow
description: Multi-agent QA flow mapped from user's AOM orchestration diagram.
document_resolution:
  active_work_order: latest modified markdown in docs/ops/work_orders
  linked_report: Report path declared in active Work Order meta
  recent_reports_default_count: 3
testing_rules:
  automation_framework: playwright
  script_language: typescript
  script_owner_node: test_scripter_codex
  execution_owner_node: tester_routing_agent
  tester_required_sequence:
    - execute_generated_scripts
    - publish_final_test_report
    - validate_testplan_generator_quality
    - decide_rerun_or_force_terminate_if_needed
  script_authoring_mode: story_only
  script_output_root: playwright/test
  script_filename_pattern: sto00X_*.spec.ts
  playwright_context_root: playwright
  required_execution_pattern:
    - npx playwright test
  artifact_expectations:
    - playwright_test_scripts
    - playwright_execution_commands
    - final_test_report
    - testplan_quality_verdict
testplan_quality_gate:
  owner_node: tester_routing_agent
  source_node: testplan_routing_agent
  required_checks:
    - target_testplan_file_exists_for_current_story
    - mandatory_sections_present
    - p0_cases_present_and_executable
    - acceptance_criteria_traceability_present
  failure_policy:
    first_action: rerun_testplan_generator
    terminal_action: force_terminate_process
    terminal_reason_codes:
      - rerun_failed
      - output_missing_after_rerun
      - output_stale_or_incomplete
testplan_routing_rules:
  owner_node: testplan_routing_agent
  reads_from: qa_reports
  primary_target_node: testplan_routing_agent_inline_deepseek
  secondary_target_node: test_scripter_codex
  dispatch_order:
    - test_scripter_codex
  wait_for_testplan_completion: false
  target_directory: docs/testplans
  required_filename_pattern: sto00X_testplan.md
  script_target_directory: playwright/test
  script_required_filename_pattern: sto00X_*.spec.ts
  script_authoring_mode: story_only
  required_report_types:
    - decision_packet
    - clerk_packet
architecture_packet_rules:
  producer_node: test_architect_mistral
  required_documents:
    - scope_and_ac_digest
    - seed_test_spec
    - golden_dataset_spec
    - traceability_matrix
    - evidence_gap_log
    - assumption_register
    - risk_seed_for_adversarial
  guidance:
    - Use docs evidence first; do not fabricate missing implementation details.
    - Mark uncertain items in assumption_register and evidence_gap_log.
db_handoff_rules:
  architecture_store:
    producer_node: test_architect_mistral
    storage: sqlite3
    table: qa_reports
    report_type: architecture_packet
  adversarial_store:
    owner_node: clerk_routing_agent
    source_node: test_architect2_deepseek_r1
    storage: sqlite3
    table: qa_reports
    report_type: adversarial_packet
  routing_lookup:
    owner_node: clerk_routing_agent
    reads_from: qa_reports
    handoff_target: decision_maker_gpt5x
  script_store:
    producer_node: test_scripter_codex
    storage: sqlite3
    table: qa_reports
    report_type: script_packet
  tester_execution_store:
    producer_node: tester_routing_agent
    source_report_type: script_packet
    source_table: qa_reports
    storage: sqlite3
    table: final_test
    stores:
      - result_status
      - error_log
      - execution_payload
  tester_testplan_followup:
    owner_node: tester_routing_agent
    checks:
      - docs_testplans_output_exists_for_current_story
      - deepseek_generation_completed
      - testplan_quality_gate_passed
    remediation_actions:
      - rerun_deepseek_testplan_generation_if_missing_or_incomplete
      - force_terminate_workflow_if_nonrecoverable
  merge_contract:
    - architecture_packet_from_sqlite_or_fallback
    - adversarial_packet_from_sqlite_or_fallback
    - merged_architect_packet
decision_preflight_rules:
  owner_node: decision_maker_gpt5x
  required_steps:
    - codebase_check_first
    - sqlite_lookup_clerk_packet_for_current_story
  execution_mode: read_only
  write_actions:
    allow_code_generation: false
    allow_code_modification: false
    allow_patch_output: false
  sqlite_lookup:
    table: qa_reports
    report_type: clerk_packet
    key_scope:
      - run_id
      - story_id
decision_handoff_contract:
  owner_node: decision_maker_gpt5x
  dispatch_owner_node: testplan_routing_agent
  common_documents:
    - handoff_manifest
    - decision_preflight_summary
    - approved_testcase_bundle
    - traceability_matrix
    - assumption_and_gap_register
    - pii_masking_rules
    - guardrail_filter_result
  handoff_to_testplan_generation:
    - testplan_input_packet
    - ui_component_scope_matrix
    - scenario_priority_plan
    - golden_dataset_usage_note
    - acceptance_checklist_for_testplan
  handoff_to_test_scripter_codex:
    - playwright_script_input_packet
    - automation_case_matrix
    - execution_profile
    - artifact_expectation_contract
    - non_goals_for_scripter
  dispatch_policy:
    order:
      - test_scripter_codex
    wait_for_testplan_completion: false
  forbidden_for_decision_maker:
    - playwright_test_scripts
    - executable_test_scripts
    - code_patch_output
entrypoint: testplan_routing_agent
nodes:
  - test_architect_mistral
  - test_architect2_deepseek_r1
  - clerk_routing_agent
  - decision_maker_gpt5x
  - testplan_routing_agent
  - test_scripter_codex
  - tester_routing_agent
edges:
  - from: testplan_routing_agent
    to: test_scripter_codex
  - from: test_scripter_codex
    to: tester_routing_agent
outputs:
  - decision_packet
  - testplan_packet
  - script_packet
  - execution_packet
  - tester_gate_decision
